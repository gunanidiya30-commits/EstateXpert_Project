<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Land Suitability Check</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-warning">
            <h5 class="mb-0">Land Suitability Check</h5>
        </div>

        <div class="card-body">
            <div class="mb-3">
                <label class="form-label">Slope (%)</label>
                <input type="number" id="slope" class="form-control" placeholder="e.g. 10">
            </div>

            <div class="mb-3">
                <label class="form-label">Road Width (feet)</label>
                <input type="number" id="road" class="form-control" placeholder="e.g. 25">
            </div>

            <div class="mb-3">
                <label class="form-label">Soil Bearing Capacity</label>
                <input type="number" id="soil" class="form-control" placeholder="e.g. 200">
            </div>

            <button class="btn btn-success w-100" onclick="checkSuitability()">
                Check Suitability
            </button>

            <div id="result" class="mt-4 d-none">
                <hr>
                <h5 id="overallResult"></h5>

                <ul class="list-group mt-3" id="detailsList"></ul>
            </div>


            <!-- E4-C: Land Improvement Suggestions -->
<div id="improvementSection" class="card mt-4 shadow d-none">
    <div class="card-header bg-warning">
        <h6 class="mb-0">Land Improvement Suggestions</h6>
    </div>
    <div class="card-body">
        <ul id="improvementList" class="mb-0"></ul>
    </div>
</div>

        </div>
    </div>
</div>

<script>
function checkSuitability() {
    const slope = document.getElementById("slope").value;
    const road = document.getElementById("road").value;
    const soil = document.getElementById("soil").value;

    if (!slope || !road || !soil) {
        alert("Please fill all fields");
        return;
    }

    fetch("http://localhost:5000/api/land-suitability", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            slope_percent: parseFloat(slope),
            road_width_feet: parseFloat(road),
            soil_bearing_capacity: parseFloat(soil)
        })
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById("overallResult").innerText =
            "Overall Result: " + data.overall_result;

        const list = document.getElementById("detailsList");
        list.innerHTML = "";

        data.details.forEach(item => {
            list.innerHTML += `
                <li class="list-group-item">
                    <strong>${item.rule}:</strong>
                    ${item.status} — ${item.message}
                </li>
            `;
       
       // E4-C: Trigger improvement suggestions ONLY on FAIL
if (data.overall_result === "FAIL") {
    const failedRules = data.details
        .filter(item => item.status === "FAIL")
        .map(item => item.rule);

    loadLandImprovements(failedRules);
}
 });

        document.getElementById("result").classList.remove("d-none");
    });
}

// E4-C — Fetch land improvement suggestions
function loadLandImprovements(failedRules) {
    fetch("http://localhost:5000/api/land-improvements", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            failed_rules: failedRules
        })
    })
    .then(response => response.json())
    .then(data => {
        const list = document.getElementById("improvementList");
        list.innerHTML = "";

        data.suggestions.forEach(item => {
            list.innerHTML += `<li>${item}</li>`;
        });

        document.getElementById("improvementSection").classList.remove("d-none");
    });
}
</script>

</body>
</html>
