<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EMI Calculator | EstateXpert</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <h2 class="mb-4">EMI Calculator</h2>

    <form id="emiForm">
        <div class="mb-3">
            <label class="form-label">Loan Amount (₹)</label>
            <input type="number" class="form-control" id="loanAmount" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Annual Interest Rate (%)</label>
            <input type="number" step="0.01" class="form-control" id="interestRate" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Tenure (Years)</label>
            <input type="number" class="form-control" id="tenureYears" required>
        </div>
        
        <div id="emiError" class="text-danger mb-2"></div>

        <button type="submit" class="btn btn-primary">
            Calculate EMI
        </button>
    </form>

    <hr class="my-4">

    <div id="emiResult"class="alert alert-info mt-3">
        <p><strong>Monthly EMI:</strong> —</p>
        <p><strong>Total Interest:</strong> —</p>
        <p><strong>Total Payment:</strong> —</p>
    </div>

    <hr class="my-4">

<h5>EMI Breakdown</h5>
<p class="text-muted mb-2">
    This chart shows how your total loan payment is split between
    <strong>principal repayment</strong> and <strong>interest cost</strong>.
</p>
<canvas id="emiChart" width="400" height="300"></canvas>

<p class="mt-3 text-muted">
    <strong>Note:</strong> Monthly EMI is calculated using both principal and interest.
    Higher interest rates increase the interest portion over time.
</p>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.getElementById("emiForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const loanAmount = document.getElementById("loanAmount").value;
    const interestRate = document.getElementById("interestRate").value;
    const tenureYears = document.getElementById("tenureYears").value;

        const errorDiv = document.getElementById("emiError");
errorDiv.innerText = "";

if (
    loanAmount === "" || interestRate === "" || tenureYears === "" ||
    loanAmount <= 0 || interestRate <= 0 || tenureYears <= 0
) {
    errorDiv.innerText = "Please enter valid positive values for all fields.";
    return;
}


    fetch("http://127.0.0.1:5000/calculate_emi", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            loan_amount: loanAmount,
            annual_interest_rate: interestRate,
            tenure_years: tenureYears
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
            return;
        }

        document.getElementById("emiResult").innerHTML = `
    <p class="fs-5">
    <strong>Monthly EMI:</strong>
    <span class="text-primary">₹ ${data.monthly_emi}</span>
</p>
    <p><strong>Total Interest:</strong> ₹ ${data.total_interest}</p>
    <p><strong>Total Payment:</strong> ₹ ${data.total_payment}</p>
`;

const ctx = document.getElementById("emiChart").getContext("2d");

if (window.emiChartInstance) {
    window.emiChartInstance.destroy();
}

window.emiChartInstance = new Chart(ctx, {
    type: "pie",
    data: {
        labels: ["Principal Amount", "Total Interest"],
        datasets: [{
            data: [
                data.total_payment - data.total_interest,
                data.total_interest
            ],
            backgroundColor: ["#4CAF50", "#FF7043"]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: "bottom"
            }
        }
    }
});

    })
    .catch(error => {
        console.error("Error:", error);
        alert("Failed to calculate EMI");
    });
});
</script>

</body>
</html>
